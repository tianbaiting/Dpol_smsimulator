# =========================================================================
# [EN] Test: 3 particle tracks (1 deuteron + 2 protons)
# [CN] 测试: 3条粒子轨迹 (1氘核 + 2质子)
# =========================================================================
# Proton: p=(±100, 0, 627) MeV/c -> AngleX=±9.07° (X方向偏转)
# =========================================================================

# 1. Visualization setup
/vis/open OGLIQt 1280x720

# 2. Load Geometry - B=1.0T
/control/execute /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/trajectory_viz/geometry_B100T.mac

# 3. Scene setup
/vis/drawVolume
/vis/viewer/set/upVector 1 0 0
/vis/viewer/set/viewpointThetaPhi 90. 90.
/vis/scene/add/axes 0 0 0 6000 mm

# ==========================================
# [CRITICAL] Trajectory visualization
# ==========================================
# Add trajectories to the scene
/vis/scene/add/trajectories smooth

# Color by charge: positive=blue, negative=red, neutral=green
/vis/modeling/trajectories/create/drawByCharge
/vis/modeling/trajectories/drawByCharge-0/default/setDrawStepPts true
/vis/modeling/trajectories/drawByCharge-0/default/setStepPtsSize 3

# Accumulate across events AND runs (key for multiple beamOn)
/vis/scene/endOfEventAction accumulate
/vis/scene/endOfRunAction accumulate

# Disable auto refresh
/vis/viewer/set/autoRefresh false
/vis/verbose warnings

# ==========================================
# Track 1: Deuteron 380 MeV
# ==========================================
/action/gun/Type Pencil
/action/gun/SetBeamParticleName deuteron
/action/gun/Position 0 0 -4000 mm
/action/gun/Energy 380 MeV
/action/gun/AngleX 0 deg
/action/gun/AngleY 0 deg
/run/beamOn 1

# ==========================================
# Track 2: Proton Px=+100 MeV/c (AngleX=+9.07°)
# ==========================================
/action/gun/SetBeamParticleName proton
/action/gun/Position -33.7681 0.0131 -762.6098 mm
/action/gun/Energy 195 MeV
/action/gun/AngleX 9.07 deg
/action/gun/AngleY 0 deg
/run/beamOn 1

# ==========================================
# Track 3: Proton Px=-100 MeV/c (AngleX=-9.07°)
# ==========================================
/action/gun/SetBeamParticleName proton
/action/gun/Position -33.7681 0.0131 -762.6098 mm
/action/gun/Energy 195 MeV
/action/gun/AngleX -9.07 deg
/action/gun/AngleY 0 deg
/run/beamOn 1

# ==========================================
# Final: Refresh display
# ==========================================
/vis/viewer/set/autoRefresh true
/vis/viewer/refresh
/vis/viewer/update
/vis/viewer/zoomTo 0.3

# ==========================================
# Export commands (run after viewing)
# ==========================================
# /vis/ogl/export test_3tracks.png
# /vis/ogl/printEPS
