# =========================================================================
# [EN] Trajectory visualization for B=2.0T, beam angle=6.0 deg
# [CN] 轨迹可视化: B=2.0T, 束流偏转角=6.0度
# =========================================================================
# Target position: X=-26.5470mm, Y=0.0178mm, Z=-1007.5765mm
# Deuteron: 380 MeV from (0, 0, -4m)
# Proton: p=(0, ±100, 627) MeV/c, T=195 MeV, AngleY=±9.07°
# =========================================================================

# Visualization Setup
/vis/open OGLIQt
/vis/viewer/set/autoRefresh false
/vis/verbose errors

# Load Geometry - B=2.0T
/control/execute /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/trajectory_viz/geometry_B200T.mac

/action/file/OverWrite y
/action/file/RunName trajectory_B200T_6.0deg
/action/file/SaveDirectory /home/tian/workspace/dpol/smsimulator5.5/data/simulation/g4output

# Z-X plane view (top view)
/vis/viewer/set/upVector 1 0 0
/vis/viewer/set/viewpointThetaPhi 90. 90.
/vis/drawVolume
/vis/scene/add/axes 0 0 0 6000 mm

# Trajectory accumulation across runs
/vis/scene/endOfEventAction accumulate
/vis/scene/add/trajectories smooth
/vis/modeling/trajectories/create/drawByCharge
/vis/modeling/trajectories/drawByCharge-0/default/setDrawStepPts true
/vis/modeling/trajectories/drawByCharge-0/default/setStepPtsSize 1
/vis/scene/endOfRunAction accumulate

# ==========================================
# 1. Deuteron: 380 MeV from (0, 0, -4m)
# ==========================================
/action/gun/Type Pencil
/action/gun/SetBeamParticleName deuteron
/action/gun/Position 0 0 -4000 mm
/action/gun/Energy 380 MeV
/action/gun/AngleX 0 deg
/action/gun/AngleY 0 deg
/run/beamOn 1

# ==========================================
# 2. Proton Py=+100 MeV/c from target
# ==========================================
/action/gun/Type Pencil
/action/gun/SetBeamParticleName proton
/action/gun/Position -26.5470 0.0178 -1007.5765 mm
/action/gun/Energy 195 MeV
/action/gun/AngleX 0 deg
/action/gun/AngleY 9.07 deg
/run/beamOn 1

# ==========================================
# 3. Proton Py=-100 MeV/c from target
# ==========================================
/action/gun/Type Pencil
/action/gun/SetBeamParticleName proton
/action/gun/Position -26.5470 0.0178 -1007.5765 mm
/action/gun/Energy 195 MeV
/action/gun/AngleX 0 deg
/action/gun/AngleY -9.07 deg
/run/beamOn 1

# Refresh display
/vis/viewer/set/autoRefresh true
/vis/viewer/refresh

# Save: /vis/ogl/export trajectory_B200T_6.0deg.png
