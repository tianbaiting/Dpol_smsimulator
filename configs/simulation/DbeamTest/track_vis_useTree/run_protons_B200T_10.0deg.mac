# =========================================================================
# [EN] Proton trajectory visualization using Tree input + Target parameters
# [CN] 使用Tree输入 + Target参数的质子轨迹可视化
# =========================================================================
# Field: B=2.00T, Beam angle=10.0 deg
# Target position: X=-53.7761mm, Y=0.0193mm, Z=-811.9539mm
# Proton + Neutron momenta: Px = ±100, ±150 MeV/c (8 tracks total: 4p + 4n)
# =========================================================================

# 1. Visualization setup
/vis/open OGLIQt 1280x720
# /vis/open OGL


# 2. Set Target position and angle (CRITICAL for particle direction)
/samurai/geometry/Target/Position -5.3776 .0019 -81.1953 cm
/samurai/geometry/Target/Angle 10.0 deg

# 3. Load Geometry
/control/execute /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/trajectory_viz/geometry_B200T.mac


/action/file/OverWrite y
/action/file/RunName protons_B200T_10.0deg
/action/file/SaveDirectory /home/tian/workspace/dpol/smsimulator5.5/data/simulation/g4output

# 4. Draw volume
/vis/drawVolume

# 5. Set Z-X plane view (top view)
/vis/viewer/set/upVector 1 0 0
/vis/viewer/set/viewpointThetaPhi 90. 90.

# 6. Add coordinate axes
/vis/scene/add/axes 0 0 0 6000 mm

# ==========================================
# Trajectory visualization settings
# ==========================================
/vis/scene/add/trajectories smooth
/vis/modeling/trajectories/create/drawByCharge
/vis/modeling/trajectories/drawByCharge-0/default/setDrawStepPts true
/vis/modeling/trajectories/drawByCharge-0/default/setStepPtsSize 3
/vis/scene/endOfEventAction accumulate
# /vis/scene/endOfRunAction accumulate

/vis/viewer/set/autoRefresh false
/vis/verbose warnings

# ==========================================
# Load proton data from single ROOT tree
# ==========================================
/action/gun/Type Tree
/action/gun/tree/InputFileName /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/track_vis_useTree/rootfiles/pn_8tracks.root
/action/gun/tree/TreeName tree
/action/gun/tree/beamOn 8

# ==========================================
# Refresh and Save
# ==========================================
/vis/viewer/set/autoRefresh true
/vis/viewer/refresh
/vis/viewer/update


# Save screenshot
# /vis/viewer/save /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/track_vis_useTree/output/protons_B200T_10.0deg.png  # this is not working

# Geant4 会自动根据后缀 .png 识别格式
#/vis/ogl/export /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/track_vis_useTree/output/protons_B080T_2.0deg.png

# /vis/ogl/set/exportFormat pdf
# /vis/viewer/set/background white
# /control/shell sleep 1
/vis/ogl/export /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/track_vis_useTree/output/protons_B200T_10.0deg.png
# Alternative export commands:
# /vis/ogl/export /home/tian/workspace/dpol/smsimulator5.5/configs/simulation/DbeamTest/track_vis_useTree/output/protons_B200T_10.0deg.png
# /vis/ogl/printEPS
