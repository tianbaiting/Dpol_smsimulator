# TODO（待办事项）

## 动量选择器（selector）的 isovector 效应
- 目标：评估在几何接受度限制下，np 粒子动量分布是否存在 isovector 效应。
- 步骤：
    - 计算几何接受度（acceptance）。
    - 在被接受的 np 事件中绘制粒子动量分布（分组比较不同配置/选择器）。
    - 进行统计检验（如 KS 检验、p-value）判断差异显著性。
- 输出：对比图、统计表格和结论。
- 记录字段：数据样本、选择器配置、绘图脚本路径。

## 比较：动量精度与接受度
- 目标：量化动量重建的精度（bias、resolution）随几何/仪器接受度的变化。
- 步骤：
    - 使用模拟真值计算重建动量与真值的残差分布。
    - 按接受度区间（或角度、p 范围）分组统计分辨率与效率。
    - 绘制：resolution vs p、efficiency vs acceptance 等图。
- 输出：分辨率曲线、效率曲线和总结表。

## 优化动量重建
- 目标：提高动量重建的准确性与稳定性。
- 方案对比：
    - 卡尔曼滤波器（Kalman filter）
        - 优点：自然处理测量误差与磁场小偏差，递归更新。
        - 限制：仅有两个探测站且每站只有三层（X/U/V），信息量有限，改进幅度可能受限。
    - 神经网络（NN）
        - 优点：能拟合非线性响应，结合多种输入（测量值、角度、局部磁场）。
        - 缺点：需大量标注训练数据、需选择合适网络结构并防止过拟合。
- 评估计划（建议的最小实验流程）：
    - [ ] 保留现有解析解为基线实现并记录性能指标（bias、σ、efficiency、运行时间）。
    - [ ] 实现简化的卡尔曼滤波器版本并与基线比较。
    - [ ] 训练一个小型 NN（输入：探测器测量值，输出：动量估计），验证与基线/卡尔曼比较。
    - [ ] 比较不同方法在不同噪声/磁场偏差情形下的鲁棒性。
    - [ ] 汇总结果，选择最优方案或混合方案（如 NN 校正卡尔曼输出）。
- 数据需求与设置：
    - 模拟样本量估计、噪声模型、不同磁场偏差集。
    - 交叉验证与独立测试集的划分策略。

备注：将每项任务写入 issue/任务列表并记录负责人与预计完成时间，便于管理与复现。


## smsimualtor 加入exit window

查看时候会影响到出射的粒子. 


zpol: d_discrete: Pb208 Sn112 Sn124 Xe140

ypol: phi_random Pb208 Xe130


需要重新构造pdc位置


加入氘核的路径,查看是否会击中exit window

## 

研究如何加入pdc的动量分辨率


磁场重新调研, 动量范围 ,线性, 以及是否击中(geant4)


pdc 尽量固定在exit window后面, 观察总的.  与qmdfilter可能再重新命名一个 或者加功能吧. 怎么加开关比较好.


geant4里面和 qmd里面对比一下区别, 特别是靶位置有没有弄对. 对比氘核轨迹 .

```bash
/control/getEnv SMSIMDIR
```

todo

dicussion with aki 

- [] target
- [] vacuum exit whindos
- [] 支架 in magnet
- [] polar mechanics


26号. 
