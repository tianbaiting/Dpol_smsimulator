1. 物理输入与数据筛选 (QMD Data Input)本部分主要关注量子分子动力学 (QMD) 产生的初态粒子（质子与中子）的动量分布与筛选。数据来源与可视化：分析了 Pb208 和 Xe130 靶上的 np (中子-质子) 动量分布 111。实现了交互式的 3D 动量分布可视化，支持旋转、缩放以及按极化 (Polarization) 查看 2222。旋转操作：对入射粒子方向（x轴）进行了剪切和旋转处理 3。事例筛选条件 (Cuts)：为了筛选特定的碰撞参数 (impact parameter) 并减少数据量，应用了以下动量和角度剪切条件 4444：Condition 1: $|p_{y,p} - p_{y,n}| < 150$ 且 $(p_{sum,0}^2 + p_{sum,1}^2) > 2500$。Condition 2: $(p_{x,p} + p_{x,n}) < 200$。角度筛选: $| \pi - |\phi_{rotation}| | [cite_start]< 0.2$ 5555。数据量缩减：原始 QMD 数据量巨大。若不进行动量 (P) 剪切，单靶点单 Gamma 值的事件数约为 $2 \times 10^6$ 6。应用动量 P 剪切后，事件数降至 $5 \times 10^5$ 7。进一步应用角度剪切后，事件数降至 $3 \times 10^4$ 8。2. 探测器模拟与接收度 (Simulation & Detector Setup)使用 Geant4 (G4) 进行全探测器模拟，重点关注中子探测器 NeuLAND 和 NEBULA。实验设置：靶位置 (Target Position)：设置在束流于 1.2 T 磁场中偏转 $5^{\circ}$ 后的位置 9。模拟参数：需要优化靶位置、PDC (Plastic Drift Chamber) 位置以及磁场参数 10。探测器配置：NEBULA: 包含 120 个中子计数器 (4层)，每两层配备 12 个 VETO 计数器。单中子探测效率约为 40%。NeuLAND: 径迹型 (Tracking type) 中子探测器，共 60 层，深度 3m。接收度 (Acceptance)：模拟计算了 PDC、NEBULA 以及符合测量 (Coincidence) 的接收度矩阵 11。G4 模拟速度: 约为 100 events/second 12。3. 径迹重建算法 (Reconstruction Algorithms)重建的核心目标是根据探测器击中点反推靶点的初始动量。目前尝试了三种策略，主要面临速度与精度的平衡。重建速度瓶颈: 目前 PDC 的重建速度极慢，仅为 0.1 events/second 13。算法对比：网格搜索 (Grid Search):原理: 在动量空间扫描 N 个样本，传播轨迹并选取距离靶点最近的值 14。优缺点: 鲁棒性强，能探索多峰模式，但速度极慢 15。梯度下降 (Gradient Descent):原理: 计算距离对动量的导数 $d(distance)/dP$，自适应更新 16。优缺点: 收敛快，但对噪声敏感，易陷入局部极小值 17。目前限制步长为 3 步以获取粗略结果 18。TMinuit (ROOT) (当前采用):原理: 使用 ROOT 的 TMinuit 库 (MIGRAD 算法为主，SIMPLEX 为辅) 最小化靶点距离 19。状态: 实现了从 Python (PyROOT) 到原生 C++ 的迁移以提高兼容性 20。单元测试与收敛情况：测试显示 MIGRAD 算法有时会失败 (Error code: 4)，程序会自动切换到 SIMPLEX 算法 21。收敛案例: 初始动量 800 MeV/c，真值 629 MeV/c。优化后重建值为 618.1 MeV/c，距离靶点 4.80 mm，Loss 减少了 68.2% 222222222222222222。4. 性能分析与问题 (Performance & Analysis)目前采用了 Batch 模式分析重建精度，结果显示存在明显的偏差问题。动量残差 (Momentum Residuals)：双峰问题: $\Delta p$ (Reconstructed - Original) 的直方图显示出两个峰值。一个在 0 附近，另一个在 $-200$ MeV/c 附近。这表明部分事例重建正确，但有相当一部分事例的动量被低估了约 200 MeV/c。相对动量差 $(p_{reco} - p_{orig})/p_{orig}$ 同样显示出约 -20% 的偏差峰值 23。PDC 重建质量:目前的 PDC 重建结果被标记为 "Bad"，主要是为了获取中子模拟结果而通过限制梯度下降步数做出的妥协 24。动量分辨率 $\sigma$ 约为 0.1 (10%)。5. 计算优化策略 (Computing Optimization)为了解决模拟与重建速度慢的问题 (特别是重建仅 0.1 Hz)，制定了以下优化策略 25：A. 批处理数据管理 (Batch Analysis):减少存储：在批处理过程中，通过丢弃非必要的详细径迹对象 (Track objects) 来减少内存占用和磁盘 I/O 26。B. I/O 优化:异步日志 (Asynchronous Logging): 使用 spdlog 等工具，避免同步打印阻塞主计算线程 27272727。C. 并行计算:多线程/多进程 (Multi-threading): 并行化事件处理循环，同时重建多个事件以利用多核 CPU 28。6. 后续计划 (To-Do List)根据当前进展，列出了以下待办事项 29：数据生成: 完成 QMD 数据的采样并生成用于 G4 输入的 rootfile 30。程序优化: 继续优化 G4 模拟和重建程序的性能 31。构型研究: 针对每种配置使用不同的靶位置（考虑不同的磁场和束流偏转角）32。物理分析: 研究氘核 (deuteron) 模拟中的等矢量效应 (isovector effects) 3333